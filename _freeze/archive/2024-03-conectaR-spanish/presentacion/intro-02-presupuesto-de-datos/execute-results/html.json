{
  "hash": "833441f6bcfe6f945726601b19af6d2e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"2 - Tu presupuesto de datos\"\nsubtitle: \"Introducciendo Tidymodels\"\nformat:\n  revealjs: \n    slide-number: true\n    footer: <https://workshops.tidymodels.org>\n    include-before-body: header.html\n    include-after-body: footer-annotations.html\n    theme: [default, tidymodels.scss]\n    width: 1280\n    height: 720\nknitr:\n  opts_chunk: \n    echo: true\n    collapse: true\n    comment: \"#>\"\n    fig.path: \"figures/\"\n---\n\n\n\n\n\n\n##  {background-image=\"https://media.giphy.com/media/Lr3UeH9tYu3qJtsSUg/giphy.gif\" background-size=\"40%\"}\n\n\"¬°¬°Que emoci√≥n!!\"\n\n## Datos de viajes en taxi de Chicago\n\n::: columns\n::: {.column width=\"60%\"}\n-   La ciudad de Chicago publica datos a nivel de viaje \n-   Sacamos una muestra de 10,000 viajes que ocurrieron al principio del 2022\n:::\n\n::: {.column width=\"40%\"}\n![](images/taxi_spinning.svg)\n:::\n\n:::\n\n::: footer\n<https://www.svgrepo.com/svg/8322/taxi>\n:::\n\n## Datos de viajes en taxi de Chicago\n\n::: columns\n::: {.column width=\"60%\"}\n-   `N = 10,000`\n-   Un resultado nominale, `propina`, con los niveles `\"si\"` y `\"no\"`\n-   Varias variables **nominales**, por ejemplo la identificaci√≥n del Taxi, y el tipo de pago\n-   Varias variables **num√©ricas**, por ejemplo la distancia del viaje, y los\nsubtotales del cargo por el viaje\n:::\n\n::: {.column width=\"40%\"}\n![](images/taxi.png)\n:::\n:::\n\n::: footer\nCredit: <https://unsplash.com/photos/7_r85l4eht8>\n:::\n\n:::notes\n\n\"Fare subtotals\" refers to the fare itself, tax, tolls, tip amount. \n\nActual variables in our data:\n\n`tip`: Whether the rider left a tip. A factor with levels \"yes\" and \"no\".\n\n`distance`: The trip distance, in odometer miles.\n\n`company`: The taxi company, as a factor. Companies that occurred few times were binned as \"other\".\n\n`local`: Whether the trip started in the same community area as it began. See the source data for community area values.\n\n`dow`: The day of the week in which the trip began, as a factor.\n\n`month`: The month in which the trip began, as a factor.\n\n`hour`: The hour of the day in which the trip began, as a numeric.\n\n:::\n\n## ¬øSe pueden usar estas variables?\n\n- ¬øSer√° √©tico, o hasta legal, utilizar esta variable?\n\n- ¬øLa variable estar√° disponible al momento de predecir?\n\n- ¬øLa variable contribuye a la explicaci√≥n de los resultados?\n\n## Datos de viajes en taxi de Chicago\n\n\n\n\n\nBaja los datos, y cargarlos en tu sesi√≥n de R\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndownload.file(\"https://github.com/edgararuiz/tidymodels-workshops/blob/main/archive/2024-03-conectaR-spanish/taxi.rds\",\n              \"taxi.rds\")\n\ntaxi <- readRDS(taxi.rds)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ntaxi\n#> # A tibble: 10,000 √ó 7\n#>    propina distancia compania                     local dia   mes    hora\n#>    <fct>       <dbl> <fct>                        <fct> <fct> <fct> <int>\n#>  1 si          17.2  Chicago Independents         no    Jue   Feb      16\n#>  2 si           0.88 City Service                 si    Jue   Mar       8\n#>  3 si          18.1  otra                         no    Lun   Feb      18\n#>  4 si          20.7  Chicago Independents         no    Lun   Abr       8\n#>  5 si          12.2  Chicago Independents         no    Dom   Mar      21\n#>  6 si           0.94 Sun Taxi                     si    Sab   Abr      23\n#>  7 si          17.5  Flash Cab                    no    Vie   Mar      12\n#>  8 si          17.7  otra                         no    Dom   Ene       6\n#>  9 si           1.85 Taxicab Insurance Agency Llc no    Vie   Abr      12\n#> 10 si           1.47 City Service                 no    Mar   Mar      14\n#> # ‚Ñπ 9,990 more rows\n```\n:::\n\n\n\n## Separando y \"gastando\" datos\n\nPara el aprendizaje automatico, separamos los datos, unos para entranamiento, \ny los otros para la \"prueba final\":\n\n. . .\n\n-   Los **datos de entrenamiento** se utilizan para estimar los parametros del modelo\n\n-   Los **datos de prueba ** se ponen aparte para medir la calidad del modelo\n\n. . .\n\nüö´ No utilize los datos de prueba durante el entrenamiento üö´\n\n## Separando y \"gastando\" datos\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](figures/test-train-split-1.svg)\n:::\n:::\n\n\n# Si gastamos m√°s datos ü§ë<br> mejoramos las estimaciones del modelo\n\n## Separando y \"gastando\" datos\n\n-   Gastando mucho datos en el **entrenamiento** previene que tengamos una \nbuena manera de medir la **calidad** del modelo\n\n. . .\n\n-   Gastando mucho datos en **prueba** previente que tegamos una buena estimaci√≥n \nde los **parametros**\n\n## Tu turno {transition=\"slide-in\"}\n\n![](images/parsnip-flagger.jpg){.absolute top=\"0\" right=\"0\" width=\"150\" height=\"150\"}\n\n*¬øCuando deberiamos separar nuestros datos?*\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"when-to-split\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">03</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n# Sus datos de prueba son valiosos üíé\n\n## La separaci√≥n inicial ![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"} {.annotation}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ntaxi_separar <- initial_split(taxi)\ntaxi_separar\n#> <Training/Testing/Total>\n#> <7500/2500/10000>\n```\n:::\n\n\n:::notes\nHow much data in training vs testing?\nThis function uses a good default, but this depends on your specific goal/data\nWe will talk about more powerful ways of splitting, like stratification, later\n:::\n\n## ¬øPara que es `set.seed()`?\n\n. . . \n\nPara el prop√≥sito de separar datos, R puede generar n√∫meros \"seudo-aleatorios\", \nque aunque parezcan comportarse como n√∫meros aleatorios, en realidad se generan\nde una manera espec√≠fica basada en una \"semilla\" (seed)\n\n. . .\n\nSi utilizamos la misma semilla nos permite reproducir los mismos resultados.\n\n. . .\n\nEl n√∫mero en s√≠ que elijes realmente no importa. Lo que si importa, es que no\nexperimentes con diferentes n√∫meros de la semilla con el proposito de mejorar\nla calidad del modelo.\n\n\n## Accediendo los datos ![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntaxi_entrenar <- training(taxi_separar)\ntaxi_test <- testing(taxi_separar)\n```\n:::\n\n\n## El set the entrenamiento ![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntaxi_entrenar\n#> # A tibble: 7,500 √ó 7\n#>    propina distancia compania                  local dia   mes    hora\n#>    <fct>       <dbl> <fct>                     <fct> <fct> <fct> <int>\n#>  1 si           0.7  Taxi Affiliation Services si    Mar   Mar      18\n#>  2 si           0.99 Sun Taxi                  si    Mar   Ene       8\n#>  3 si           1.78 otra                      no    Sab   Mar      22\n#>  4 si           0    Taxi Affiliation Services si    Mie   Abr      15\n#>  5 si           0    Taxi Affiliation Services no    Dom   Ene      21\n#>  6 si           2.3  otra                      no    Sab   Abr      21\n#>  7 si           6.35 Sun Taxi                  no    Mie   Mar      16\n#>  8 si           2.79 otra                      no    Dom   Feb      14\n#>  9 si          16.6  otra                      no    Dom   Abr      18\n#> 10 si           0.02 Chicago Independents      si    Dom   Abr      15\n#> # ‚Ñπ 7,490 more rows\n```\n:::\n\n\n## El set de prueba ![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"}\n\nüôà\n\n. . .\n\nEn el set de prueba, hay 2500 entradas, con 7 columnas\n\n## Tu turno {transition=\"slide-in\"}\n\n![](images/parsnip-flagger.jpg){.absolute top=\"0\" right=\"0\" width=\"150\" height=\"150\"}\n\n*Separa tus datos, el 20% tiene que ser para prueba*\n\n*Trata diferentes valores para `set.seed()` para ver como cambian los resultados*\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"try-splitting\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">05</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n## Separando y \"gastando\" datos ![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ntaxi_separar <- initial_split(taxi, prop = 0.8)\ntaxi_entrenar <- training(taxi_separar)\ntaxi_test <- testing(taxi_separar)\n\nnrow(taxi_entrenar)\n#> [1] 8000\nnrow(taxi_test)\n#> [1] 2000\n```\n:::\n\n\n# ¬øY que pas√≥ con los datos para validar?\n\n##  \n\n\n```{mermaid}\n%%| eval: true\n%%| fig-width: 20\nflowchart TD\n  ad[Todos\\nlos datos]\n  style ad fill:#fff,stroke:#666,color:#000\n  tr[Entrenamiento]\n  style tr fill:#FBE9BF,stroke:#666,color:#000\n  ts[Prueba]\n  style ts fill:#E5E7FD,stroke:#666,color:#000  \n  vl[Validaci√≥n]\n  style vl fill:#E5E7FD,stroke:#666,color:#000    \n  ad --> tr\n  ad --> ts\n  ad --> vl\n```\n\n\n\n## Datos de validaci√≥n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ninitial_validation_split(taxi, prop = c(0.6, 0.2))\n#> <Training/Validation/Testing/Total>\n#> <6000/2000/2000/10000>\n```\n:::\n\n\n# An√°lisis exploratorio para Aprendizaje Autom√°tico üßê\n\n## Tu turno {transition=\"slide-in\"}\n\n![](images/parsnip-flagger.jpg){.absolute top=\"0\" right=\"0\" width=\"150\" height=\"150\"}\n\n*Explora los datos en `taxi_entrenar` por t√≠ mismo*\n\n* *¬øCual es la distribuci√≥n de los resultados de `propina`?*\n* *¬øCual es la distribuci√≥n de las variables num√©ricas, por ejemplo `distancia`?*\n* *¬øComo cambian los resultados de `propina` a trav√©s de las variables categ√≥ricas?*\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"explore-taxi\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">08</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n::: notes\nMake a plot or summary and then share with neighbor\n:::\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntaxi_entrenar %>% \n  ggplot(aes(x = propina)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](figures/taxi-tip-counts-1.svg){fig-align='center'}\n:::\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntaxi_entrenar %>% \n  ggplot(aes(x = propina, fill = local)) +\n  geom_bar() +\n  scale_fill_viridis_d(end = .5)\n```\n\n::: {.cell-output-display}\n![](figures/taxi-tip-by-local-1.svg){fig-align='center'}\n:::\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntaxi_entrenar %>% \n  ggplot(aes(x = hora, fill = propina)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](figures/taxi-tip-by-hour-1.svg){fig-align='center'}\n:::\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntaxi_entrenar %>% \n  ggplot(aes(x = hora, fill = propina)) +\n  geom_bar(position = \"fill\")\n```\n\n::: {.cell-output-display}\n![](figures/taxi-tip-by-hour-fill-1.svg){fig-align='center'}\n:::\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntaxi_entrenar %>% \n  ggplot(aes(x = distancia)) +\n  geom_histogram(bins = 100) +\n  facet_grid(vars(propina))\n```\n\n::: {.cell-output-display}\n![](figures/taxi-tip-by-distance-1.svg){fig-align='center'}\n:::\n:::\n\n\n# Separa inteligentemente\n\n##\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](figures/taxi-tip-pct-1.svg)\n:::\n:::\n\n\nEstratificar la muestra separar√° los datos dentro los valores de respuesta\n\n:::notes\nBased on our EDA, we know that the source data contains fewer `\"no\"` tip values than `\"yes\"`. We want to make sure we allot equal proportions of those responses so that both the training and testing data have enough of each to give accurate estimates.\n:::\n\n## Estratificar\n\nUse `strata = propina`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ntaxi_separar <- initial_split(taxi, prop = 0.8, strata = propina)\ntaxi_separar\n#> <Training/Testing/Total>\n#> <8000/2000/10000>\n```\n:::\n\n\n## Estratificar\n\nEstratificar la muestra usualmente ayuda, y con pocas consecuencias \n\n\n::: {.cell}\n::: {.cell-output-display}\n![](figures/taxi-tip-pct-by-split-1.svg)\n:::\n:::\n\n\n## Expectativas del taller - Donde estamos\n\n\n```{mermaid}\n%%| eval: true\n%%| fig-width: 12\nflowchart LR\n  ad[Todos\\nlos datos]\n  style ad fill:#fff,stroke:#666,color:#000\n  tr[Entrenamiento]\n  style tr fill:#FBE9BF,stroke:#666,color:#000\n  ts[Prueba]\n  style ts fill:#E5E7FD,stroke:#666,color:#000\n  ad --> tr\n  ad --> ts\n  rs[Remuestreo]\n  style rs fill:#fff,stroke:#eee,color:#ddd\n  tr --> rs\n  lg[Regresi√≥n\\nlog√≠stica]\n  style lg fill:#fff,stroke:#eee,color:#ddd\n  rs --> lg\n  dt[Arbol de\\nDecisi√≥n]\n  style dt fill:#fff,stroke:#eee,color:#ddd\n  rs --> dt\n  rf[Bosque\\nAleatorio]\n  style rf fill:#fff,stroke:#eee,color:#ddd\n  rs --> rf\n  sm[Seleccionar\\nmodelo]\n  style sm fill:#fff,stroke:#eee,color:#ddd\n  lg --> sm\n  dt --> sm\n  rf --> sm\n  fm[Entrenar modelo\\nselecionado]\n  style fm fill:#fff,stroke:#eee,color:#ddd\n  sm --> fm\n  tr --> fm\n  vm[Verificar la\\ncalidad]\n  style vm fill:#fff,stroke:#eee,color:#ddd\n  fm --> vm\n  ts --> vm\n\n```\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}