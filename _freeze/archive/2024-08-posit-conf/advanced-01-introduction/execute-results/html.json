{
  "hash": "d51107aca02fc7ed78ff60eea802c80a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"1 - Introduction\"\nsubtitle: \"Advanced tidymodels\"\nformat:\n  revealjs: \n    slide-number: true\n    footer: <https://workshops.tidymodels.org>\n    include-before-body: header.html\n    include-after-body: footer-annotations.html\n    theme: [default, tidymodels.scss]\n    width: 1280\n    height: 720\nknitr:\n  opts_chunk: \n    echo: true\n    collapse: true\n    comment: \"#>\"\n---\n\n\n\n\n\n::: r-fit-text\nWelcome!\n:::\n\n::: columns\n::: {.column width=\"50%\"}\n\n<center>\n\n### <i class=\"fa fa-wifi\"></i>\n\nWi-Fi network name\n\n`TODO-ADD-LATER`\n\n</center>\n\n:::\n\n::: {.column width=\"50%\"}\n\n<center>\n\n### <i class=\"fa fa-key\"></i>\n\nWi-Fi password\n\n`TODO-ADD-LATER`\n\n</center>\n\n:::\n:::\n\n## Venue information\n\n-   There are gender neutral bathrooms located on levels 3, 4, 5, 6 & 7\n\n-   A meditation/prayer room is located in 503  \n(Mon & Tue 7am - 7pm, and Wed 7am - 5pm)\n\n-   A lactation room is located in 509  \n(Mon & Tue 7am - 7pm, and Wed 7am - 5pm)\n\n## Workshop policies\n\n-   Please review the posit::conf code of conduct, which applies to all workshops: <https://posit.co/code-of-conduct>\n\n-   CoC site has info on how to report a problem (in person, email, phone)\n\n-   Please do not photograph people wearing red lanyards\n\n## Who are you?\n\n-   You can use the magrittr `%>%` or base R `|>` pipe\n\n-   You are familiar with functions from dplyr, tidyr, ggplot2\n\n-   You have exposure to basic statistical concepts\n\n-   You do **not** need intermediate or expert familiarity with modeling or ML\n\n-   You have used some tidymodels packages\n \n-   You have some experience with evaluating statistical models using resampling techniques \n\n## Who are tidymodels?\n\n-   Simon Couch\n-   Hannah Frick\n-   Emil Hvitfeldt\n-   Max Kuhn\n\n. . .\n\nMany thanks to Davis Vaughan, Julia Silge, David Robinson, Julie Jung, Alison Hill, and DesirÃ©e De Leon for their role in creating these materials!\n\n## Asking for help\n\n. . .\n\nðŸŸª \"I'm stuck and need help!\"\n\n. . .\n\nðŸŸ© \"I finished the exercise\"\n\n\n## Discord `<svg aria-hidden=\"true\" role=\"img\" viewBox=\"0 0 640 512\" style=\"height:1em;width:1.25em;vertical-align:-0.125em;margin-left:auto;margin-right:auto;font-size:inherit;fill:currentColor;overflow:visible;position:relative;\"><path d=\"M524.531,69.836a1.5,1.5,0,0,0-.764-.7A485.065,485.065,0,0,0,404.081,32.03a1.816,1.816,0,0,0-1.923.91,337.461,337.461,0,0,0-14.9,30.6,447.848,447.848,0,0,0-134.426,0,309.541,309.541,0,0,0-15.135-30.6,1.89,1.89,0,0,0-1.924-.91A483.689,483.689,0,0,0,116.085,69.137a1.712,1.712,0,0,0-.788.676C39.068,183.651,18.186,294.69,28.43,404.354a2.016,2.016,0,0,0,.765,1.375A487.666,487.666,0,0,0,176.02,479.918a1.9,1.9,0,0,0,2.063-.676A348.2,348.2,0,0,0,208.12,430.4a1.86,1.86,0,0,0-1.019-2.588,321.173,321.173,0,0,1-45.868-21.853,1.885,1.885,0,0,1-.185-3.126c3.082-2.309,6.166-4.711,9.109-7.137a1.819,1.819,0,0,1,1.9-.256c96.229,43.917,200.41,43.917,295.5,0a1.812,1.812,0,0,1,1.924.233c2.944,2.426,6.027,4.851,9.132,7.16a1.884,1.884,0,0,1-.162,3.126,301.407,301.407,0,0,1-45.89,21.83,1.875,1.875,0,0,0-1,2.611,391.055,391.055,0,0,0,30.014,48.815,1.864,1.864,0,0,0,2.063.7A486.048,486.048,0,0,0,610.7,405.729a1.882,1.882,0,0,0,.765-1.352C623.729,277.594,590.933,167.465,524.531,69.836ZM222.491,337.58c-28.972,0-52.844-26.587-52.844-59.239S193.056,219.1,222.491,219.1c29.665,0,53.306,26.82,52.843,59.239C275.334,310.993,251.924,337.58,222.491,337.58Zm195.38,0c-28.971,0-52.843-26.587-52.843-59.239S388.437,219.1,417.871,219.1c29.667,0,53.307,26.82,52.844,59.239C470.715,310.993,447.538,337.58,417.871,337.58Z\"/></svg>`{=html}\n\n-   [pos.it/conf-event-portal](http://pos.it/conf-event-portal) (login)\n-   Click on \"Join Discord, the virtual networking platform!\"\n-   Browse Channels -> `#workshop-tidymodels-advanced`\n\n## ðŸ‘€ {.annotation}\n\n![](images/pointing.svg){.absolute top=\"0\" right=\"0\"}\n\n## ðŸ‘€\n\n![](images/pointing_down.png){.absolute top=\"120\" left=\"200\" width=\"40%\" }\n\n::: footer\n<span style=\"color:#CA225E;font-size:1.2rem;\"><https://workshops.tidymodels.org></span>\n:::\n\n## Tentative plan for this workshop\n\n- Feature engineering with recipes\n- Model optimization by tuning\n  - Grid search\n  - Racing\n  - Iterative methods\n- Extras (time permitting)\n  - Effect encodings\n  - A case study\n\n##  {.center}\n\n### Introduce yourself to your neighbors ðŸ‘‹\n\n<br></br>\n\n### <i class=\"fa fa-cloud\"></i> Log in to Posit Cloud (free): TODO-ADD-LATER\n\n## Let's install some packages\n\nIf you are using your own laptop instead of Posit Cloud:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Install the packages for the workshop\npkgs <- \n  c(\"bonsai\", \"Cubist\", \"doParallel\", \"earth\", \"embed\", \"finetune\", \n    \"forested\", \"lightgbm\", \"lme4\", \"parallelly\", \"plumber\", \"probably\", \n    \"ranger\", \"rpart\", \"rpart.plot\", \"rules\", \"splines2\", \"stacks\", \n    \"text2vec\", \"textrecipes\", \"tidymodels\", \"vetiver\")\n\ninstall.packages(pkgs)\n```\n:::\n\n\n\nAlso, you should install the newest version of the dials package (version 1.3.0). To check this, you can run: \n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrlang::check_installed(\"dials\", version = \"1.3.0\")\n```\n:::\n\n\n\n## Hotel Data ![](hexes/tidymodels.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"} ![](hexes/dplyr.png){.absolute top=-20 right=64 width=\"64\" height=\"74.24\"}\n\nWe'll use [data on hotels](https://www.sciencedirect.com/science/article/pii/S2352340918315191) to predict the cost of a room. \n\nThe [data](https://modeldata.tidymodels.org/reference/hotel_rates.html) are in the modeldata package. We'll sample down the data and refactor some columns: \n\n:::: {.columns}\n\n::: {.column width=\"40%\"}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidymodels)\n\n# Max's usual settings: \ntidymodels_prefer()\ntheme_set(theme_bw())\noptions(\n  pillar.advice = FALSE, \n  pillar.min_title_chars = Inf\n)\n```\n:::\n\n\n\n:::\n\n::: {.column width=\"60%\"}\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata(hotel_rates)\nset.seed(295)\nhotel_rates <- \n  hotel_rates %>% \n  sample_n(5000) %>% \n  arrange(arrival_date) %>% \n  select(-arrival_date) %>% \n  mutate(\n    company = factor(as.character(company)),\n    country = factor(as.character(country)),\n    agent = factor(as.character(agent))\n  )\n```\n:::\n\n\n\n\n:::\n\n::::\n\n## Hotel date columns\n\n\n\n::: {.cell labels='hotel-names'}\n\n```{.r .cell-code}\nnames(hotel_rates)\n#>  [1] \"avg_price_per_room\"             \"lead_time\"                     \n#>  [3] \"stays_in_weekend_nights\"        \"stays_in_week_nights\"          \n#>  [5] \"adults\"                         \"children\"                      \n#>  [7] \"babies\"                         \"meal\"                          \n#>  [9] \"country\"                        \"market_segment\"                \n#> [11] \"distribution_channel\"           \"is_repeated_guest\"             \n#> [13] \"previous_cancellations\"         \"previous_bookings_not_canceled\"\n#> [15] \"reserved_room_type\"             \"assigned_room_type\"            \n#> [17] \"booking_changes\"                \"agent\"                         \n#> [19] \"company\"                        \"days_in_waiting_list\"          \n#> [21] \"customer_type\"                  \"required_car_parking_spaces\"   \n#> [23] \"total_of_special_requests\"      \"arrival_date_num\"              \n#> [25] \"near_christmas\"                 \"near_new_years\"                \n#> [27] \"historical_adr\"\n```\n:::\n\n\n\n\n## Data splitting strategy\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](images/initial-split.svg){fig-align='center' width=20%}\n:::\n:::\n\n\n\n\n## Data Spending ![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"}\n\nLet's split the data into a training set (75%) and testing set (25%) using stratification:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(4028)\nhotel_split <- initial_split(hotel_rates, strata = avg_price_per_room)\n\nhotel_train <- training(hotel_split)\nhotel_test <- testing(hotel_split)\n```\n:::\n\n\n\n\n\n## Your turn {transition=\"slide-in\"}\n\nLet's take some time and investigate the _training data_. The outcome is `avg_price_per_room`. \n\nAre there any interesting characteristics of the data?\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"countdown\" id=\"hotel-investigation\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">10</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n\n:::\n:::\n\n\n\n## Our versions\n\n\n\n::: {.cell}\n\n:::\n\n\n\nR version 4.4.1 (2024-06-14), Quarto (1.6.1)\n\n::: {.columns style=\"font-size:0.7em;\"}\n::: {.column width=\"25%\"}\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|package    |version |\n|:----------|:-------|\n|bonsai     |0.3.1   |\n|broom      |1.0.6   |\n|Cubist     |0.4.4   |\n|dials      |1.3.0   |\n|doParallel |1.0.17  |\n|dplyr      |1.1.4   |\n|earth      |5.3.3   |\n|embed      |1.1.4   |\n|finetune   |1.2.0   |\n|Formula    |1.2-5   |\n\n\n:::\n:::\n\n\n:::\n\n::: {.column width=\"25%\"}\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|package    |version  |\n|:----------|:--------|\n|ggplot2    |3.5.1    |\n|lattice    |0.22-6   |\n|lightgbm   |4.5.0    |\n|lme4       |1.1-35.5 |\n|modeldata  |1.4.0    |\n|parallelly |1.38.0   |\n|parsnip    |1.2.1    |\n|plotmo     |3.6.3    |\n|plotrix    |3.8-4    |\n|plumber    |1.2.2    |\n\n\n:::\n:::\n\n\n:::\n\n::: {.column width=\"25%\"}\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|package     |version |\n|:-----------|:-------|\n|probably    |1.0.3   |\n|purrr       |1.0.2   |\n|recipes     |1.1.0   |\n|rsample     |1.2.1   |\n|rules       |1.0.2   |\n|scales      |1.3.0   |\n|splines2    |0.5.3   |\n|stacks      |1.0.5   |\n|text2vec    |0.6.4   |\n|textrecipes |1.0.6   |\n\n\n:::\n:::\n\n\n:::\n\n::: {.column width=\"25%\"}\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n\n|package      |version |\n|:------------|:-------|\n|tibble       |3.2.1   |\n|tidymodels   |1.2.0   |\n|tidyr        |1.3.1   |\n|tune         |1.2.1   |\n|vetiver      |0.2.5   |\n|workflows    |1.1.4   |\n|workflowsets |1.1.0   |\n|yardstick    |1.3.1   |\n\n\n:::\n:::\n\n\n:::\n:::\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}