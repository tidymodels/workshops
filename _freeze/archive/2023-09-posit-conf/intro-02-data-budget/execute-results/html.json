{
  "hash": "6a2f34cea7b8cbaf35f8a630290c923a",
  "result": {
    "markdown": "---\ntitle: \"2 - Your data budget\"\nsubtitle: \"Introduction to tidymodels\"\nformat:\n  revealjs: \n    slide-number: true\n    footer: <https://workshops.tidymodels.org>\n    include-before-body: header.html\n    include-after-body: footer-annotations.html\n    theme: [default, tidymodels.scss]\n    width: 1280\n    height: 720\nknitr:\n  opts_chunk: \n    echo: true\n    collapse: true\n    comment: \"#>\"\n    fig.path: \"figures/\"\n---\n\n\n\n\n##  {background-image=\"https://media.giphy.com/media/Lr3UeH9tYu3qJtsSUg/giphy.gif\" background-size=\"40%\"}\n\n\n## Data on Chicago taxi trips\n\n::: columns\n::: {.column width=\"60%\"}\n-   The city of Chicago releases anonymized trip-level data on taxi trips in the city.\n-   We pulled a sample of 10,000 rides occurring in early 2022.\n-   Type `?taxi` to learn more about this dataset, including references.\n:::\n\n::: {.column width=\"40%\"}\n![](images/taxi_spinning.svg)\n:::\n\n:::\n\n::: footer\nCredit: <https://www.svgrepo.com/svg/8322/taxi>\n:::\n\n## Data on Chicago taxi trips\n\n::: columns\n::: {.column width=\"60%\"}\n-   `N = 10,000`\n-   A nominal outcome, `tip`, with levels `\"yes\"` and `\"no\"`\n-   Several **nominal** variables like pickup & dropoff location, taxi ID, and payment type.\n-   Several **numeric** variables like trip length and fare subtotals.\n:::\n\n::: {.column width=\"40%\"}\n![](images/taxi.png)\n:::\n:::\n\n::: footer\nCredit: <https://unsplash.com/photos/7_r85l4eht8>\n:::\n\n:::notes\n\n\"Fare subtotals\" refers to the fare itself, tax, tolls, tip amount. \n\nActual variables in our data:\n\n`tip`: Whether the rider left a tip. A factor with levels \"yes\" and \"no\".\n\n`distance`: The trip distance, in odometer miles.\n\n`company`: The taxi company, as a factor. Companies that occurred few times were binned as \"other\".\n\n`local`: Whether the trip started in the same community area as it began. See the source data for community area values.\n\n`dow`: The day of the week in which the trip began, as a factor.\n\n`month`: The month in which the trip began, as a factor.\n\n`hour`: The hour of the day in which the trip began, as a numeric.\n\n:::\n\n## Checklist for predictors\n\n- Is it ethical to use this variable? (Or even legal?)\n\n- Will this variable be available at prediction time?\n\n- Does this variable contribute to explainability?\n\n\n## Data on Chicago taxi trips\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidymodels)\n\ntaxi\n#> # A tibble: 10,000 √ó 7\n#>    tip   distance company                      local dow   month  hour\n#>    <fct>    <dbl> <fct>                        <fct> <fct> <fct> <int>\n#>  1 yes      17.2  Chicago Independents         no    Thu   Feb      16\n#>  2 yes       0.88 City Service                 yes   Thu   Mar       8\n#>  3 yes      18.1  other                        no    Mon   Feb      18\n#>  4 yes      20.7  Chicago Independents         no    Mon   Apr       8\n#>  5 yes      12.2  Chicago Independents         no    Sun   Mar      21\n#>  6 yes       0.94 Sun Taxi                     yes   Sat   Apr      23\n#>  7 yes      17.5  Flash Cab                    no    Fri   Mar      12\n#>  8 yes      17.7  other                        no    Sun   Jan       6\n#>  9 yes       1.85 Taxicab Insurance Agency Llc no    Fri   Apr      12\n#> 10 yes       1.47 City Service                 no    Tue   Mar      14\n#> # ‚Ñπ 9,990 more rows\n```\n:::\n\n\n\n## Data splitting and spending\n\nFor machine learning, we typically split data into training and test sets:\n\n. . .\n\n-   The **training set** is used to estimate model parameters.\n-   The **test set** is used to find an independent assessment of model performance.\n\n. . .\n\nDo not üö´ use the test set during training.\n\n## Data splitting and spending\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](figures/test-train-split-1.svg)\n:::\n:::\n\n\n# The more data<br>we spend ü§ë<br><br>the better estimates<br>we'll get.\n\n## Data splitting and spending\n\n-   Spending too much data in **training** prevents us from computing a good assessment of predictive **performance**.\n\n. . .\n\n-   Spending too much data in **testing** prevents us from computing a good estimate of model **parameters**.\n\n## Your turn {transition=\"slide-in\"}\n\n![](images/parsnip-flagger.jpg){.absolute top=\"0\" right=\"0\" width=\"150\" height=\"150\"}\n\n*When is a good time to split your data?*\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"when-to-split\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">03</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n# The testing data is precious üíé\n\n## The initial split ![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"} {.annotation}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ntaxi_split <- initial_split(taxi)\ntaxi_split\n#> <Training/Testing/Total>\n#> <7500/2500/10000>\n```\n:::\n\n\n:::notes\nHow much data in training vs testing?\nThis function uses a good default, but this depends on your specific goal/data\nWe will talk about more powerful ways of splitting, like stratification, later\n:::\n\n## What is `set.seed()`?\n\nTo create that split of the data, R generates \"pseudo-random\" numbers: while they are made to behave like random numbers, their generation is deterministic give a \"seed\".\n\nThis allows us to reproduce results by setting that seed.\n\nWhich seed you pick doesn't matter, as long as you don't try a bunch of seeds and pick the one that gives you the best performance.\n\n## Accessing the data ![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntaxi_train <- training(taxi_split)\ntaxi_test <- testing(taxi_split)\n```\n:::\n\n\n## The training set![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntaxi_train\n#> # A tibble: 7,500 √ó 7\n#>    tip   distance company                   local dow   month  hour\n#>    <fct>    <dbl> <fct>                     <fct> <fct> <fct> <int>\n#>  1 yes       0.7  Taxi Affiliation Services yes   Tue   Mar      18\n#>  2 yes       0.99 Sun Taxi                  yes   Tue   Jan       8\n#>  3 yes       1.78 other                     no    Sat   Mar      22\n#>  4 yes       0    Taxi Affiliation Services yes   Wed   Apr      15\n#>  5 yes       0    Taxi Affiliation Services no    Sun   Jan      21\n#>  6 yes       2.3  other                     no    Sat   Apr      21\n#>  7 yes       6.35 Sun Taxi                  no    Wed   Mar      16\n#>  8 yes       2.79 other                     no    Sun   Feb      14\n#>  9 yes      16.6  other                     no    Sun   Apr      18\n#> 10 yes       0.02 Chicago Independents      yes   Sun   Apr      15\n#> # ‚Ñπ 7,490 more rows\n```\n:::\n\n\n## The test set ![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"}\n\nüôà\n\n. . .\n\nThere are 2500 rows and 7 columns in the test set.\n\n## Your turn {transition=\"slide-in\"}\n\n![](images/parsnip-flagger.jpg){.absolute top=\"0\" right=\"0\" width=\"150\" height=\"150\"}\n\n*Split your data so 20% is held out for the test set.*\n\n*Try out different values in `set.seed()` to see how the results change.*\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"try-splitting\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">05</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n## Data splitting and spending ![](hexes/rsample.png){.absolute top=-20 right=0 width=\"64\" height=\"74.24\"}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ntaxi_split <- initial_split(taxi, prop = 0.8)\ntaxi_train <- training(taxi_split)\ntaxi_test <- testing(taxi_split)\n\nnrow(taxi_train)\n#> [1] 8000\nnrow(taxi_test)\n#> [1] 2000\n```\n:::\n\n\n# What about a validation set?\n\n##  {background-color=\"white\" background-image=\"https://www.tmwr.org/premade/validation.svg\" background-size=\"50%\"}\n\n## Validation set\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ninitial_validation_split(taxi, prop = c(0.6, 0.2))\n#> <Training/Validation/Testing/Total>\n#> <6000/2000/2000/10000>\n```\n:::\n\n\n# Exploratory data analysis for ML üßê\n\n## Your turn {transition=\"slide-in\"}\n\n![](images/parsnip-flagger.jpg){.absolute top=\"0\" right=\"0\" width=\"150\" height=\"150\"}\n\n*Explore the `taxi_train` data on your own!*\n\n* *What's the distribution of the outcome, `tip`?*\n* *What's the distribution of numeric variables like `distance`?*\n* *How does `tip` differ across the categorical variables?*\n\n\n::: {.cell}\n::: {.cell-output-display}\n```{=html}\n<div class=\"countdown\" id=\"explore-taxi\" data-update-every=\"1\" tabindex=\"0\" style=\"right:0;bottom:0;\">\n<div class=\"countdown-controls\"><button class=\"countdown-bump-down\">&minus;</button><button class=\"countdown-bump-up\">&plus;</button></div>\n<code class=\"countdown-time\"><span class=\"countdown-digits minutes\">08</span><span class=\"countdown-digits colon\">:</span><span class=\"countdown-digits seconds\">00</span></code>\n</div>\n```\n:::\n:::\n\n\n::: notes\nMake a plot or summary and then share with neighbor\n:::\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntaxi_train %>% \n  ggplot(aes(x = tip)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](figures/taxi-tip-counts-1.svg){fig-align='center'}\n:::\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntaxi_train %>% \n  ggplot(aes(x = tip, fill = local)) +\n  geom_bar() +\n  scale_fill_viridis_d(end = .5)\n```\n\n::: {.cell-output-display}\n![](figures/taxi-tip-by-local-1.svg){fig-align='center'}\n:::\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntaxi_train %>% \n  ggplot(aes(x = hour, fill = tip)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](figures/taxi-tip-by-hour-1.svg){fig-align='center'}\n:::\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntaxi_train %>% \n  ggplot(aes(x = hour, fill = tip)) +\n  geom_bar(position = \"fill\")\n```\n\n::: {.cell-output-display}\n![](figures/taxi-tip-by-hour-fill-1.svg){fig-align='center'}\n:::\n:::\n\n\n## \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntaxi_train %>% \n  ggplot(aes(x = distance)) +\n  geom_histogram(bins = 100) +\n  facet_grid(vars(tip))\n```\n\n::: {.cell-output-display}\n![](figures/taxi-tip-by-distance-1.svg){fig-align='center'}\n:::\n:::\n\n\n# Split smarter\n\n##\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](figures/taxi-tip-pct-1.svg)\n:::\n:::\n\n\nStratified sampling would split within response values\n\n:::notes\nBased on our EDA, we know that the source data contains fewer `\"no\"` tip values than `\"yes\"`. We want to make sure we allot equal proportions of those responses so that both the training and testing data have enough of each to give accurate estimates.\n:::\n\n## Stratification\n\nUse `strata = tip`\n\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(123)\ntaxi_split <- initial_split(taxi, prop = 0.8, strata = tip)\ntaxi_split\n#> <Training/Testing/Total>\n#> <8000/2000/10000>\n```\n:::\n\n\n## Stratification\n\nStratification often helps, with very little downside\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](figures/taxi-tip-pct-by-split-1.svg)\n:::\n:::\n\n\n## The whole game - status update\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](images/whole-game-transparent-split.jpg){fig-align='center' width=3543}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/countdown-0.4.0/countdown.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/countdown-0.4.0/countdown.js\"></script>\n"
      ],
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}